- # ✍️ 项目开发核心准则 (CLAUDE.md)

  ### 🔄 项目上下文与感知

  - **始终以 `instructions.md` 和 `bussiness.md` 为核心业务逻辑参考**，在开始新任务前阅读它们，以理解项目的业务目标、角色权限和核心流程。
  - **开发前务必查阅 `数据库详解.md`**，以确保数据模型、字段和关联关系的正确性。
  - **检查 `TASK.md`** 在开始新任务前，如果任务未列出，添加简要描述和今天的日期
  - **遵循 `微服务项目骨架.md` 中定义的项目结构**，保持模块划分和包命名的一致性。
  - **使用统一的 Git 提交规范** 按照项目文档中的格式要求

  ### ⛩️ 代码结构与微服务规范

  - **遵循微服务架构**，将业务逻辑分离到指定的模块中（如 `auth-service`, `lead-service`, `deal-service` 等）。
  - **永远不在单个 Controller/Service 文件中编写过长的代码**。如果一个文件接近500行，应考虑重构并拆分逻辑。
  - **创建通用代码时，将其放入 `common` 模块**，例如统一响应体 `CommonResult`、全局异常处理器、JWT工具类、枚举等。
  - **使用清晰、一致的导包方式**，优先使用绝对路径导包以避免混淆。
  - **配置文件使用 Nacos 集中管理**，遵循 `模块名-dev.yaml` 的命名规则。
  - **使用统一的微服务架构模式** Spring Boot + Spring Cloud + Nacos

  ### ✅ Git 与版本控制

  - **所有 Git 提交必须严格遵循以下格式**：
    `<type>(<scope>): <description>_<versionid>`
    - **示例**: `feat(auth): 添加JWT认证机制_v1.2.0`
  - **分支管理**:
    - `main`: 生产稳定分支。
    - `dev`: 开发主分支，用于合并各功能分支。
    - `feature-xxx`: 具体的功能开发分支。
  - **禁止直接向 `main` 或 `dev` 分支提交代码**，所有功能开发都应在 `feature` 分支上进行，并通过 Pull Request 合并。

  ### 🔐 安全与权限

  - **所有接口必须进行 JWT Token 验证**
  - **实现基于角色的权限控制 (RBAC)**，角色包括：super_admin / director / leader / sales / agent
  - **实现数据级权限控制**，确保用户只能访问其权限范围内的数据
  - **客户手机号作为唯一标识**，防止重复录入

  ### 🧪 测试与可靠性

  - **为所有新功能（特别是 Service 层的核心逻辑）编写 JUnit 单元测试**。
  - **测试代码应存放在 `src/test/java` 目录下**，其包结构应与主代码 `src/main/java` 保持一致。
  - **测试至少应覆盖**：
    - 1个正常场景（happy path）
    - 1个边界条件（edge case）
    - 1个异常/失败场景（failure case）
  - **在修改现有逻辑后，必须检查并更新相关的单元测试**。

  ### ✅ 任务完成

  - **在完成任务后立即在 `TASK.md` 中标记完成的任务**
  - 在开发过程中发现的新子任务或 TODO 添加到 `TASK.md` 的 "开发中发现" 部分

  ### 🎨 风格与约定

  - **主要编程语言为 Java**，使用 Spring Boot 和 Spring Cloud Alibaba 技术栈。
  - **遵循 Alibaba Java 编码规范**，推荐在 IDE 中安装相关插件。
  - 使用 Spring Boot 构建微服务，MyBatis 作为 ORM，MySQL + Redis 作为存储
  - **所有 Controller 接口都应使用 `@Operation` 等 Swagger注解**，提供清晰的接口说明。
  - **为所有非简单的公共方法编写 Javadoc 注释**，遵循标准格式。

  ### 📚 文档与可读性

  - **当新增功能、修改依赖或调整部署步骤时，及时更新 `README.md`**。
  - **为复杂的业务逻辑（如佣金计算、等级评定）添加必要的行内注释**，解释“为什么”这么做，而不仅仅是“做什么”。
  - **数据库表结构的任何变更，都必须同步更新到 `数据库详解.md` 并生成新的 `*.sql` 脚本**。

  ### 🧠 AI 行为准则

  - **绝不臆测缺失的上下文。如果不确定，就提问。**
  - **绝不捏造不存在的库、函数或 Spring 注解**，只使用已知的、可靠的技术。
  - **在生成代码或测试前，务必确认文件路径和模块名称存在**。
  - **除非明确指示或作为任务的一部分，否则绝不删除或覆盖现有代码。**